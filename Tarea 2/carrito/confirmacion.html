<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Confirmación - La Fornace</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" href="../styles.css">
    <link rel="icon" type="image/png" href="../image/pizzeria_la_fornace_png.png">
</head>
<body class="bg-cream">
    <!-- Historia: B-12 Confirmación de Pedidos vía Email -->
    
    <nav class="navbar navbar-expand-lg navbar-dark bg-fornace sticky-top shadow-sm">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="../index.html">
                <img src="../image/pizzeria_la_fornace_png.png" alt="La Fornace" width="56" height="56" class="me-2">
                <span>La Fornace</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="mainNav">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="../index.html">Menú</a></li>
                    <li class="nav-item"><a class="nav-link" href="../tu-cuenta/index.html">Tu Cuenta</a></li>
                    <li class="nav-item"><a class="nav-link" href="../tu-cuenta/pedidos.html">Tus Pedidos</a></li>
                    <li class="nav-item">
                        <a class="btn btn-sm btn-primary ms-lg-3" href="../carrito/index.html">
                            Carrito <span class="badge text-bg-light ms-1" id="carrito-badge">0</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container py-5">
        <div class="row">
            <div class="col-12 col-lg-8 mx-auto">
                <!-- Mensaje de éxito -->
                <div class="alert alert-success text-center py-5 mb-4">
                    <div class="mb-3">
                        <svg width="80" height="80" fill="currentColor" class="text-success" viewBox="0 0 16 16">
                            <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                        </svg>
                    </div>
                    <h2 class="mb-3">Pedido Confirmado</h2>
                    <p class="lead mb-0">Tu pedido ha sido recibido y está siendo procesado</p>
                </div>
                
                <!-- Detalles del pedido -->
                <div class="card mb-4">
                    <div class="card-header bg-fornace text-white">
                        <h5 class="mb-0">Detalles del Pedido <span id="pedido-numero"></span></h5>
                    </div>
                    <div class="card-body" id="pedido-detalles">
                        <!-- Se llena dinámicamente -->
                    </div>
                </div>
                
                <!-- Información de entrega -->
                <div class="card mb-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">Información de Entrega</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Dirección</label>
                                <p class="mb-0" id="confirmacion-direccion"></p>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Tiempo Estimado</label>
                                <p class="mb-0">
                                    <span class="badge bg-primary fs-6" id="confirmacion-eta"></span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Confirmación de email -->
                <div class="card mb-4 border-success">
                    <div class="card-body bg-light">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <div class="d-flex align-items-center">
                                    <svg width="40" height="40" fill="currentColor" class="text-success me-3" viewBox="0 0 16 16">
                                        <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z"/>
                                    </svg>
                                    <div>
                                        <h6 class="mb-1">Confirmación enviada por email</h6>
                                        <small class="text-muted">Revisa tu correo electrónico (<span id="confirmacion-email"></span>)</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 text-md-end mt-3 mt-md-0">
                                <button class="btn btn-outline-primary btn-sm" onclick="reenviarEmail()">
                                    Reenviar Email
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Total -->
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <h4 class="mb-0">Total Pagado</h4>
                            <h3 class="mb-0 text-primary" id="confirmacion-total">$0</h3>
                        </div>
                    </div>
                </div>
                
                <!-- Botones de acción -->
                <div class="d-grid gap-2 d-md-flex justify-content-md-between">
                    <a href="../tu-cuenta/pedidos.html" class="btn btn-outline-secondary btn-lg">
                        Ver mis Pedidos
                    </a>
                    <a href="../index.html#menu" class="btn btn-primary btn-lg">
                        Seguir Comprando
                    </a>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container text-center small">
            <img src="../image/pizzeria_la_fornace_png.png" alt="La Fornace" width="40" class="mb-2">
            <div>Pizzería La Fornace · Solo entregamos calidad</div>
            <div>© 2025 La Fornace · Todos los derechos reservados</div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="../data/mock-data.js"></script>
    <script src="../scripts.js"></script>
    
    <script>
      let pedidoActual = null;
      
      // ========================================
      // CARGAR DETALLES DEL PEDIDO
      // ========================================
      function cargarDetallesPedido() {
        // Obtener último pedido desde localStorage
        const ultimoPedidoStr = localStorage.getItem('ultimoPedido');
        
        if (!ultimoPedidoStr) {
          // Si no hay pedido, redirigir al carrito
          window.location.href = 'index.html';
          return;
        }
        
        pedidoActual = JSON.parse(ultimoPedidoStr);
        
        // Mostrar número de pedido
        document.getElementById('pedido-numero').textContent = `#${pedidoActual.id}`;
        
        // Renderizar items
        const detallesContainer = document.getElementById('pedido-detalles');
        detallesContainer.innerHTML = '';
        
        pedidoActual.items.forEach(item => {
          const itemDiv = document.createElement('div');
          itemDiv.className = 'd-flex justify-content-between align-items-center mb-3 pb-3 border-bottom';
          
          itemDiv.innerHTML = `
            <div>
              <h6 class="mb-1">${item.nombre}</h6>
              <small class="text-muted text-capitalize">Tamaño: ${item.tamaño}</small>
              <br>
              <small class="text-muted">Cantidad: ${item.cantidad}</small>
            </div>
            <div class="text-end">
              <div class="fw-bold">${formatearPrecio(item.precio * item.cantidad)}</div>
              <small class="text-muted">${formatearPrecio(item.precio)} c/u</small>
            </div>
          `;
          
          detallesContainer.appendChild(itemDiv);
        });
        
        // Agregar desglose de costos
        const costos = document.createElement('div');
        costos.className = 'pt-3';
        costos.innerHTML = `
          <div class="d-flex justify-content-between mb-2">
            <span class="text-muted">Subtotal</span>
            <span>${formatearPrecio(pedidoActual.total - pedidoActual.costoEnvio)}</span>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span class="text-muted">Costo de Envío</span>
            <span>${formatearPrecio(pedidoActual.costoEnvio)}</span>
          </div>
        `;
        detallesContainer.appendChild(costos);
        
        // Mostrar información de entrega
        document.getElementById('confirmacion-direccion').textContent = pedidoActual.direccion;
        document.getElementById('confirmacion-eta').textContent = pedidoActual.eta;
        document.getElementById('confirmacion-email').textContent = usuario.email;
        document.getElementById('confirmacion-total').textContent = formatearPrecio(pedidoActual.total);
        
        // Limpiar el último pedido después de mostrarlo (para evitar que se muestre al recargar)
        // localStorage.removeItem('ultimoPedido');
      }
      
      // ========================================
      // REENVIAR EMAIL DE CONFIRMACIÓN
      // ========================================
      function reenviarEmail() {
        if (!pedidoActual) return;
        
        // Simular reenvío de email
        mostrarExito('Email de confirmación reenviado a ' + usuario.email);
        
        // Deshabilitar botón temporalmente
        const btnReenviar = event.target;
        btnReenviar.disabled = true;
        btnReenviar.textContent = 'Enviando...';
        
        setTimeout(() => {
          btnReenviar.disabled = false;
          btnReenviar.textContent = 'Reenviar Email';
        }, 3000);
      }
      
      // ========================================
      // INICIALIZACIÓN
      // ========================================
      document.addEventListener('DOMContentLoaded', function() {
        // Cargar carrito desde localStorage (debería estar vacío)
        cargarCarrito();
        
        // Cargar detalles del pedido
        cargarDetallesPedido();
        
        // Actualizar badge del carrito (debería ser 0)
        actualizarBadgeCarrito();
      });
    </script>
</body>
</html>


